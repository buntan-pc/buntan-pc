# buntan-pc リポジトリでの開発の進め方
BuntanPC はいくつかのコンポーネントから構成されていて、各コンポーネントにはメンテナが設定されています。
コードやドキュメントの変更にはメンテナのレビューを受ける必要があります。

## コンポーネントとメンテナ
現在のメンテナ割り当ては次表の通りです。

| コンポーネント名 | メンテナ                | 説明                                       |
|------------------|-------------------------|--------------------------------------------|
| cpu              | uchan-nos (Kota UCHIDA) | uchan 製 CPU/MCU                           |
| board            | uchan-nos (Kota UCHIDA) | uchan 製マザーボード                       |
| dos              | uchan-nos (Kota UCHIDA) | uchan 製 DOS                               |
| uas              | uchan-nos (Kota UCHIDA) | uchan 製アセンブラ                         |
| ucc              | uchan-nos (Kota UCHIDA) | uchan 製 C コンパイラ                      |
| scripts          | BuntanPC Authors        | どのコンポーネントにも属さない小物ツール群 |
| doc              | BuntanPC Authors        | どのコンポーネントにも属さないドキュメント |

### 新たなコンポーネントの追加

既存のコンポーネントと被らない適切な名前を与え、上記の表に追記してください。
例えば C コンパイラを追加する場合、「Xcc」とするのでもいいですし、cc が語尾に付かない名前にしても良いです。

## 開発の方針
根本となる方針は「最小限のものを作る」です。
必要か分からない機能をむやみに付け足さない、とも言えます。

この方針の目的は、プロジェクトを小さく保つためです。
プロジェクトが小さいほどコードの可読性が上がり、全体が簡単に把握でき、後から加入したメンバーが追いつきやすくなります。

### 機能を追加する妥当な理由の例
厳密に最小限を考える必要はありません。
その機能を開発する妥当な理由の例を示します。

- かなりの確率で他のプロジェクトメンバーが喜ぶ・便利になるだろう機能を思いついた。
  - 実際に機能を作り始める前に、軽くで良いので他のメンバーに意見を求めてください。
- コンパイラが新しい CPU 命令を必要としている。
  - 前提として、コンパイラに妥当な変更を加える場合の話です。
    誰が使うか分からない機能をコンパイラに追加するために新しい CPU 命令が必要だ、というのではダメです。
- 実機で機械語入力によるプログラミングのデモをするために、高度な機能を実現する便利命令が欲しい。
  - その命令を追加するとデモが非常にやりやすくなるのであれば、追加して良いです。
- 汎用的な構造にしておくことで後の開発を効率化できる。
  - 汎用的な構造を作るのは一般にコストがかかりますが、その後の開発を効率化できるならそのコストを払う価値があります。
  - ただし、他のプロジェクトメンバーが理解しにくい複雑過ぎる構造にならないよう注意してください。

### あえて追加していない機能の例
逆に、あえて導入していない機能の例を挙げます。

- LT 命令と対になる GT 命令
  - LT は `A < B` を計算し、GT は両辺が逆になったものです。
  - `A > B` を計算したいときは、コンパイラが左右を逆にすれば良いだけなので、CPU に GT を追加する必要がありません。
    - もし仮に「コンパイラの改造コスト > CPU に GT を追加するコスト」なら、GT を追加する方が良いですね。
- 整数 + ポインタ
  - ポインタを左辺に置いた「ポインタ + 整数」はサポートしていますが、その逆は正しく認識しません。
  - 今のところ「整数 + ポインタ」の文法に対応すべき強い理由がないため、サポートしていません。

## ADR
[ADR（Architecture Decision Record）](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)
は設計の意図を記した文書のことです。
BuntanPC プロジェクトでは、重要な設計事項を ADR として記し、GitHub Wiki に貯めます。

- Architecture: ソフトウェアの構造、仕組み
- Decision: 意思決定（メンバー同士で議論して決定したこと）
- Record: 記録票

というような意味で、要するに重要な設計についてメンバー間で議論し、その結果を忘れないために記録しておく文書です。
ADR を書く目的は次の通りです。

- 議論の結果を思い出すため。
- 議論を蒸し返さないため。
- 新しく加わったメンバーが設計の意図を知るため。

### ADR のステータス遷移
ADR は Draft から始まります。

- Draft（下書き）：ADR を書いている途中の状態。メンバーの意見を集めながら書き進めたい場合、Draft で一旦公開する。
- Proposed（提案）：ADR が提案され、レビュー中の状態。ここから Accepted か Rejected に進む。
- Accepted（受入）：提案が受け入れられた状態。ADR にしたがって開発を進める。
- Rejected（拒否）：提案が受け入れられなかった状態。将来の参考のため、Rejected になっても削除せずとっておく。
- Deprecated（廃止）：ADR の内容が不要になったりして廃止された状態。
- Superseded（更新）：後継となる ADR に取って代わられた状態。ADR の中身を書き換えるのではなく、新しい ADR を作り、古い方を Superseded とする。

ある ADR を Deprecated や Superseded にする場合、新しい ADR と古い ADR を結びつけることが重要です。
具体的には

- 古い ADR（通し番号 i とする）のステータスを `Deprecated: [[ADR-j]] により廃止` や `Superseded: 後継は [[ADR-j]]` などとし、
- 新しい ADR（通し番号 j とする）に `[[ADR-j]] を廃止` や `[[ADR-j]] を更新` などと記します。
